{% extends 'pages/base.html' %}

{% block content %}
<div class="container mt-4">
<!-- 
  Django Messages -->
  <!-- {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %} --> 

<!-- First row: Chick & Feed stock -->
<div class="row mb-4">
  <!-- Layers Stock Card -->
  <div class="col-md-3 mb-3">
    <div class="card h-100 text-center" style="background-color: #004d00; color: white;">
      <div class="card-body py-3">
        <h5 class="card-title">Layers Stock</h5>
        <p class="card-text h3">{{ stock_summary.layer.total_quantity|default:"0" }}</p>
        <small>Available</small>
      </div>
    </div>
  </div>

  <!-- Broilers Stock Card -->
  <div class="col-md-3 mb-3">
    <div class="card h-100 text-center" style="background-color: black; color: white;">
      <div class="card-body py-3">
        <h5 class="card-title">Broilers Stock</h5>
        <p class="card-text h3">{{ stock_summary.broiler.total_quantity|default:"0" }}</p>
        <small>Available</small>
      </div>
    </div>
  </div>

  <!-- Feed Stock Card -->
  <div class="col-md-3 mb-3">
    <div class="card h-100 text-center" style="background-color: #006600; color: white;">
      <div class="card-body py-3">
        <h5 class="card-title">Feed Stock</h5>
        <p class="card-text h3">{{ feed_stock|default:"0" }}</p>
        <small>Available (bags)</small>
      </div>
    </div>
  </div>

  <!-- Pending Requests Card -->
  <div class="col-md-3 mb-3">
    <div class="card h-100 text-center" style="background-color: white; color: black;">
      <div class="card-body py-3">
        <h5 class="card-title">Pending Requests</h5>
        <p class="card-text h3">
          {{ pending_requests_count|default:"0" }}
        </p>
        <small>Awaiting Approval</small>
      </div>
    </div>
  </div>
</div>



  <!-- All Requests Table -->
  <div class="card shadow-lg border-0 rounded-3 mt-4">
    <div class="card-header" style="background-color: #004d00; color: white; text-align: center; padding: 15px;">
      <h4 class="mb-0">All Chick Requests</h4>
    </div>
    <div class="card-body">
      {% if requests %}
        <div class="table-responsive">
          <table class="table table-hover table-bordered align-middle">
            <thead style="background-color: #004d00; color: white;" class="text-center">
              <tr>
                <th>Farmer</th>
                <th>Chick Type</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Feed Needed</th>
                <th>Period (days)</th>
                <th>Requested By</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody style="color: black;">
              {% for req in requests %}
                <tr>
                  <td>{{ req.farmer_name }}</td>
                  <td>{{ req.chick_type }}</td>
                  <td class="text-center">{{ req.chick_quantity }}</td>
                  <td>
                    {% if req.chick_status == 'approved' %}
                      <span class="badge" style="background-color:#004d00; color: white;">Approved</span>
                    {% elif req.chick_status == 'pending' %}
                      <span class="badge" style="background-color: white; color: black;">Pending</span>
                    {% else %}
                      <span class="badge" style="background-color:black; color: white; border: 1px solid black;">Rejected</span>
                    {% endif %}
                  </td>
                  <td>{{ req.feed_needed }}</td>
                  <td class="text-center">{{ req.chickperiod }}</td>
                  <td>{{ req.sales_agent }}</td>
                  <td>{{ req.chick_date|date:"Y-m-d H:i" }}</td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Actions">
                      {% if request.user == req.sales_agent %}
                        <a href="{% url 'record_request_edit' req.id %}" class="btn" style="background-color: black; color: white;">Edit</a>
                        <a href="{% url 'delete_request' req.id %}" class="btn" style="background-color: #004d00; color: white;"
                           onclick="return confirm('Delete this request?');">Delete</a>
                      {% endif %}
                      {% if request.user.user_type == 'manager' and req.chick_status == 'pending' %}
                        <a href="{% url 'approve_request' req.id %}" class="btn" style="background-color: black; color: white;">Approve</a>
                        <a href="{% url 'reject_request' req.id %}" class="btn" style="background-color: white; color: black; border: 1px solid black;">Reject</a>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-center" style="color: #004d00; font-weight:bold;">No chick requests found.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
